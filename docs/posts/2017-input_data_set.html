<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.508">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kyle Baron">
<meta name="dcterms.date" content="2017-01-01">
<meta name="description" content="An important mechanism for creating robust, complex simulations is the input data set. In this blog post, weâ€™ll look at some ways you can quickly create input data sets for your simulation.">

<title>mrgsolve/blog - Generating input data sets for mrgsolve</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>
    .quarto-title-block .quarto-title-banner {
      color: white;
background: #097f5f;
    }
    </style>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="mrgsolve/blog - Generating input data sets for mrgsolve">
<meta property="og:description" content="An important mechanism for creating robust, complex simulations is the input data set. In this blog post, we'll look at some ways you can quickly create input data sets for your simulation.
">
<meta property="og:image" content="https://mrgsolve.org/blog/images/preview.png">
<meta property="og:site-name" content="mrgsolve/blog">
<meta name="twitter:title" content="mrgsolve/blog - Generating input data sets for mrgsolve">
<meta name="twitter:description" content="An important mechanism for creating robust, complex simulations is the input data set. In this blog post, we'll look at some ways you can quickly create input data sets for your simulation.
">
<meta name="twitter:image" content="https://mrgsolve.org/blog/images/preview.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">mrgsolve/blog</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://mrgsolve.org/user_guide">UserGuide</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://mrgsolve.org/blog">Blog</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://mrgsolve.org/vignettes">Vignettes</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://mrgsolve.org/learn.html">Learn</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://mrgsolve.org/docs">Docs</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/mrgsolve/depot">Models</a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-source" role="button" data-bs-toggle="dropdown" aria-expanded="false">Source</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-source">    
        <li>
    <a class="dropdown-item" href="https://github.com/metrumresearchgroup/mrgsolve">
 <span class="dropdown-text">GitHub</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://cran.r-project.org/package=mrgsolve">
 <span class="dropdown-text">CRAN</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-help" role="button" data-bs-toggle="dropdown" aria-expanded="false">Help</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-help">    
        <li>
    <a class="dropdown-item" href="https://github.com/metrumresearchgroup/mrgsolve/discussions">
 <span class="dropdown-text">Discuss</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/metrumresearchgroup/mrgsolve/issues">
 <span class="dropdown-text">Report an issue</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://mrgsolve.org">mrgsolve.org</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/metrumresearchgroup/mrgsolve"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/mrgsolve"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Generating input data sets for mrgsolve</h1>
                  <div>
        <div class="description">
          <p>An important mechanism for creating robust, complex simulations is the input data set. In this blog post, weâ€™ll look at some ways you can quickly create input data sets for your simulation.</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">data set</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Kyle Baron </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 1, 2017</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#input-data-sets" id="toc-input-data-sets" class="nav-link active" data-scroll-target="#input-data-sets"> <span class="header-section-number">1</span> Input data sets</a></li>
  <li><a href="#functions-to-generate-input-data-sets" id="toc-functions-to-generate-input-data-sets" class="nav-link" data-scroll-target="#functions-to-generate-input-data-sets"> <span class="header-section-number">2</span> Functions to generate input data sets</a>
  <ul class="collapse">
  <li><a href="#expand.ev" id="toc-expand.ev" class="nav-link" data-scroll-target="#expand.ev"> <span class="header-section-number">2.1</span> <code>expand.ev</code></a></li>
  <li><a href="#as_data_set" id="toc-as_data_set" class="nav-link" data-scroll-target="#as_data_set"> <span class="header-section-number">2.2</span> <code>as_data_set</code></a></li>
  <li><a href="#as.data.frame.ev" id="toc-as.data.frame.ev" class="nav-link" data-scroll-target="#as.data.frame.ev"> <span class="header-section-number">2.3</span> <code>as.data.frame.ev</code></a></li>
  <li><a href="#assign_ev" id="toc-assign_ev" class="nav-link" data-scroll-target="#assign_ev"> <span class="header-section-number">2.4</span> <code>assign_ev</code></a></li>
  <li><a href="#ev_days" id="toc-ev_days" class="nav-link" data-scroll-target="#ev_days"> <span class="header-section-number">2.5</span> <code>ev_days</code></a></li>
  </ul></li>
  <li><a href="#filter-input-data-set-inline" id="toc-filter-input-data-set-inline" class="nav-link" data-scroll-target="#filter-input-data-set-inline"> <span class="header-section-number">3</span> Filter input data set inline</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(mrgsolve)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="input-data-sets" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Input data sets</h1>
<p>An important mechanism for creating robust, complex simulations is the input data set. Input data sets specify the population of individuals to simulate, including the number of individuals, each individualâ€™s dosing interventions, each individualâ€™s covariate values etc. The input data set is just a plain old <code>R</code> <code>data.frame</code>, but with some expectations about which columns are present and expectations for how to handle columns for certain names. For example, every input data set has to have an <code>ID</code>, <code>time</code>, and <code>cmt</code> column. Note that either lower case names (like <code>time</code> and <code>cmt</code>) are acceptable as are upper case names (like <code>TIME</code> and <code>CMT</code>). But users are not to mix upper and lower case names (like <code>time</code> and <code>CMT</code>) for certain column names related to dosing events. The help topic <code>?data_set</code> discusses more about what the expectations are for input data sets.</p>
<hr>
</section>
<section id="functions-to-generate-input-data-sets" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Functions to generate input data sets</h1>
<code>mrgsolve</code> provides several functions and workflows to help you put together the right input data set for your simulation. The main point of this blog post is to review some of these functions to help you better organize your <code>mrgsolve</code> simulations. Some functions are very simple and you might not find a function to do <strong>exactly</strong> what you want to do. But weâ€™ve found these functions to be helpful to accomplish tasks that we found ourselves repeating over and over â€¦ and thus these tasks were formalized in a function. Just keep in mind that input data sets are just <code>data.frames</code> â€¦ you can use any code or any function (even your own!) to do tasks similar to what these functions are doing.
<hr>
<section id="expand.ev" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="expand.ev"><span class="header-section-number">2.1</span> <code>expand.ev</code></h2>
<p><code>expand.ev</code> is like <code>expand.grid</code>: it creates a single <code>data.frame</code> with all combinations of itâ€™s vector arguments. Itâ€™s pretty simple but convenient to have. For example,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>data <span class="ot">&lt;-</span> <span class="fu">expand.ev</span>(<span class="at">amt=</span><span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">200</span>,<span class="dv">300</span>), <span class="at">ID=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID time amt cmt evid
1  1    0 100   1    1
2  2    0 200   1    1
3  3    0 300   1    1
4  4    0 100   1    1
5  5    0 200   1    1
6  6    0 300   1    1
7  7    0 100   1    1
8  8    0 200   1    1
9  9    0 300   1    1</code></pre>
</div>
</div>
<p>This function call gives us 3 individuals at each of 3 doses. The <code>expand.grid</code> nature of <code>expand.ev</code> is what gives us <code>3x3=9</code> rows in the data set. Notice that the <code>IDs</code> are now 1 through 9 â€¦ <code>expand.ev</code> renumbers <code>IDs</code> so that there is only one dosing event per row and there is on row per <code>ID</code>.</p>
<p>Also notice that <code>time</code> defaults to 0, <code>evid</code> defaults to 1, and <code>cmt</code> defaults to 1. So, <code>expand.ev</code> fills in some of the required columns for you.</p>
<p>Letâ€™s simulate with this data set: ::: {.cell}</p>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>mod <span class="ot">&lt;-</span> mrgsolve<span class="sc">:::</span><span class="fu">house</span>() <span class="sc">%&gt;%</span> <span class="fu">Req</span>(CP) </span>
<span id="cb4-2"><a href="#cb4-2"></a>mod <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="fu">mrgsim</span>(<span class="at">data=</span>data) <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="fu">plot</span>(CP<span class="sc">~</span>time<span class="sc">|</span><span class="fu">factor</span>(ID),<span class="at">scales=</span><span class="st">"same"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2017-input_data_set_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
<p>:::</p>
<hr>
</section>
<section id="as_data_set" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="as_data_set"><span class="header-section-number">2.2</span> <code>as_data_set</code></h2>
<p>This function allows you to combine several event objects into a single data sets. An example works best to illustrate.</p>
<p>First, create three event objects. Letâ€™s try one <code>ID</code> at 100 mg, two <code>IDs</code> at 200 mg, and 3 <code>IDs</code> at 300 mg. ::: {.cell}</p>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>e1 <span class="ot">&lt;-</span> <span class="fu">ev</span>(<span class="at">amt=</span><span class="dv">100</span>, <span class="at">ID=</span><span class="dv">1</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a>e2 <span class="ot">&lt;-</span> <span class="fu">ev</span>(<span class="at">amt=</span><span class="dv">200</span>, <span class="at">ID=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb5-3"><a href="#cb5-3"></a>e3 <span class="ot">&lt;-</span> <span class="fu">ev</span>(<span class="at">amt=</span><span class="dv">300</span>, <span class="at">ID=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>:::</p>
<p>The events are ::: {.cell}</p>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>e1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Events:
  ID time amt cmt evid
1  1    0 100   1    1</code></pre>
</div>
<p>::: and ::: {.cell}</p>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>e2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Events:
    ID time amt cmt evid
1    1    0 200   1    1
1.1  2    0 200   1    1</code></pre>
</div>
<p>::: and ::: {.cell}</p>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>e3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Events:
    ID time amt cmt evid
1    1    0 300   1    1
1.1  2    0 300   1    1
1.2  3    0 300   1    1</code></pre>
</div>
<p>:::</p>
<p>When we combine these events with <code>as_data_set</code> we get ::: {.cell}</p>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>data <span class="ot">&lt;-</span> <span class="fu">as_data_set</span>(e1,e2,e3)</span>
<span id="cb12-2"><a href="#cb12-2"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        ID time cmt evid amt
...1     1    0   1    1 100
1...2    2    0   1    1 200
1.1...3  3    0   1    1 200
1...4    4    0   1    1 300
1.1...5  5    0   1    1 300
1.2      6    0   1    1 300</code></pre>
</div>
<p>:::</p>
<p>A nice feature of <code>as_data_set</code> is, unlike <code>expand.ev</code> and the previous example, we can use complicated event sequences that are expressed with more than one line in the data set. For example, consider the case where every <code>ID</code> gets a 250 mg loading dose, and then either get 250 mg q24h, or 120 mg q12h or 500 mg q48h.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>load <span class="ot">&lt;-</span> <span class="cf">function</span>(n) <span class="fu">ev</span>(<span class="at">amt=</span><span class="dv">250</span>, <span class="at">ID=</span><span class="dv">1</span><span class="sc">:</span>n)</span>
<span id="cb14-2"><a href="#cb14-2"></a>e1 <span class="ot">&lt;-</span> <span class="fu">load</span>(<span class="dv">1</span>) <span class="sc">+</span> <span class="fu">ev</span>(<span class="at">amt=</span><span class="dv">250</span>, <span class="at">time=</span><span class="dv">24</span>, <span class="at">ii=</span><span class="dv">24</span>, <span class="at">addl=</span><span class="dv">3</span>, <span class="at">ID=</span><span class="dv">1</span>)</span>
<span id="cb14-3"><a href="#cb14-3"></a>e2 <span class="ot">&lt;-</span> <span class="fu">load</span>(<span class="dv">2</span>) <span class="sc">+</span> <span class="fu">ev</span>(<span class="at">amt=</span><span class="dv">125</span>, <span class="at">time=</span><span class="dv">24</span>, <span class="at">ii=</span><span class="dv">12</span>, <span class="at">addl=</span><span class="dv">7</span>, <span class="at">ID=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb14-4"><a href="#cb14-4"></a>e3 <span class="ot">&lt;-</span> <span class="fu">load</span>(<span class="dv">3</span>) <span class="sc">+</span> <span class="fu">ev</span>(<span class="at">amt=</span><span class="dv">500</span>, <span class="at">time=</span><span class="dv">24</span>, <span class="at">ii=</span><span class="dv">48</span>, <span class="at">addl=</span><span class="dv">1</span>, <span class="at">ID=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, <code>e1</code>, <code>e2</code>, and <code>e3</code> are more complex ::: {.cell}</p>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>e1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Events:
  ID time amt cmt evid ii addl
1  1    0 250   1    1  0    0
2  1   24 250   1    1 24    3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>e3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Events:
        ID time amt cmt evid ii addl
1...1    1    0 250   1    1  0    0
1...4    1   24 500   1    1 48    1
1.1...2  2    0 250   1    1  0    0
1.1...5  2   24 500   1    1 48    1
1.2...3  3    0 250   1    1  0    0
1.2...6  3   24 500   1    1 48    1</code></pre>
</div>
<p>:::</p>
<p>But, we can still pull them together in one single data set ::: {.cell}</p>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>data <span class="ot">&lt;-</span> <span class="fu">as_data_set</span>(e1,e2,e3)</span>
<span id="cb19-2"><a href="#cb19-2"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ID time cmt evid amt ii addl
...1      1    0   1    1 250  0    0
...2      1   24   1    1 250 24    3
1...3     2    0   1    1 250  0    0
1...4     2   24   1    1 125 12    7
1.1...5   3    0   1    1 250  0    0
1.1...6   3   24   1    1 125 12    7
1...7     4    0   1    1 250  0    0
1...8     4   24   1    1 500 48    1
1.1...9   5    0   1    1 250  0    0
1.1...10  5   24   1    1 500 48    1
1.2...11  6    0   1    1 250  0    0
1.2...12  6   24   1    1 500 48    1</code></pre>
</div>
<p>:::</p>
<p>An example simulation ::: {.cell}</p>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="fu">set.seed</span>(<span class="dv">1112</span>)</span>
<span id="cb21-2"><a href="#cb21-2"></a>mod <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3"></a>  <span class="fu">omat</span>(<span class="fu">dmat</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">/</span><span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="#cb21-4"></a>  <span class="fu">data_set</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb21-5"><a href="#cb21-5"></a>  <span class="fu">mrgsim</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb21-6"><a href="#cb21-6"></a>  plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2017-input_data_set_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
:::
<hr>
</section>
<section id="as.data.frame.ev" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="as.data.frame.ev"><span class="header-section-number">2.3</span> <code>as.data.frame.ev</code></h2>
<p>Just a quick reminder here that you can easily convert between a single event object and a <code>data.frame</code> ::: {.cell}</p>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">as.data.frame</span>(e3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        ID time amt cmt evid ii addl
1...1    1    0 250   1    1  0    0
1...4    1   24 500   1    1 48    1
1.1...2  2    0 250   1    1  0    0
1.1...5  2   24 500   1    1 48    1
1.2...3  3    0 250   1    1  0    0
1.2...6  3   24 500   1    1 48    1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="fu">as.ev</span>(<span class="fu">as.data.frame</span>(e3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Events:
        ID time amt ii addl cmt evid
1...1    1    0 250  0    0   1    1
1...4    1   24 500 48    1   1    1
1.1...2  2    0 250  0    0   1    1
1.1...5  2   24 500 48    1   1    1
1.2...3  3    0 250  0    0   1    1
1.2...6  3   24 500 48    1   1    1</code></pre>
</div>
<p>:::</p>
<p>So if you were building up an event object and just wanted to use it as a <code>data_set</code> or as a building block for a <code>data_set</code>, just coerce with <code>as.data.frame</code>.</p>
<hr>
</section>
<section id="assign_ev" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="assign_ev"><span class="header-section-number">2.4</span> <code>assign_ev</code></h2>
<p>This function assigns an intervention in the form of an event object to individuals in an <code>idata_set</code> according to a grouping column.</p>
<p>To illustrate, make a simple <code>idata_set</code> ::: {.cell}</p>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">set.seed</span>(<span class="dv">8</span>)</span>
<span id="cb26-2"><a href="#cb26-2"></a>idata <span class="ot">&lt;-</span> <span class="fu">data_frame</span>(<span class="at">ID=</span><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>), <span class="at">arm=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `data_frame()` was deprecated in tibble 1.1.0.
Please use `tibble()` instead.
This warning is displayed once every 8 hours.
Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>idata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 Ã— 2
     ID   arm
  &lt;int&gt; &lt;dbl&gt;
1     4     1
2     2     2
3     3     2
4     6     3
5     5     3
6     1     3</code></pre>
</div>
<p>:::</p>
<p>Here, we have 6 <code>IDs</code>, one in arm 1, two in arm 2, three in arm 3. Letâ€™s take the events from the previous example and assign them to the different arms.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>e1 <span class="ot">&lt;-</span> <span class="fu">ev</span>(<span class="at">amt=</span><span class="dv">250</span>) <span class="sc">+</span> <span class="fu">ev</span>(<span class="at">amt=</span><span class="dv">250</span>, <span class="at">time=</span><span class="dv">24</span>, <span class="at">ii=</span><span class="dv">24</span>, <span class="at">addl=</span><span class="dv">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2"></a>e2 <span class="ot">&lt;-</span> <span class="fu">ev</span>(<span class="at">amt=</span><span class="dv">250</span>) <span class="sc">+</span> <span class="fu">ev</span>(<span class="at">amt=</span><span class="dv">125</span>, <span class="at">time=</span><span class="dv">24</span>, <span class="at">ii=</span><span class="dv">12</span>, <span class="at">addl=</span><span class="dv">7</span>)</span>
<span id="cb30-3"><a href="#cb30-3"></a>e3 <span class="ot">&lt;-</span> <span class="fu">ev</span>(<span class="at">amt=</span><span class="dv">250</span>) <span class="sc">+</span> <span class="fu">ev</span>(<span class="at">amt=</span><span class="dv">500</span>, <span class="at">time=</span><span class="dv">24</span>, <span class="at">ii=</span><span class="dv">48</span>, <span class="at">addl=</span><span class="dv">1</span>)</span>
<span id="cb30-4"><a href="#cb30-4"></a><span class="fu">assign_ev</span>(<span class="fu">list</span>(e3,e2,e1),idata,<span class="st">"arm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   time amt cmt evid ii addl ID
1     0 250   1    1  0    0  4
2    24 500   1    1 48    1  4
3     0 250   1    1  0    0  2
4    24 125   1    1 12    7  2
5     0 250   1    1  0    0  3
6    24 125   1    1 12    7  3
7     0 250   1    1  0    0  6
8    24 250   1    1 24    3  6
9     0 250   1    1  0    0  5
10   24 250   1    1 24    3  5
11    0 250   1    1  0    0  1
12   24 250   1    1 24    3  1</code></pre>
</div>
</div>
<p>Please look carefully at the input (<code>idata</code> and <code>list(e3,e2,e1)</code>); I have mixed it up a bit here to try to illustrate how things are assigned.</p>
<hr>
</section>
<section id="ev_days" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="ev_days"><span class="header-section-number">2.5</span> <code>ev_days</code></h2>
<p>This is a recently-added function (hint: you might need to install the latest version from GitHub to use this) that lets you schedule certain events on certain days of the week, repeating in a weekly cycle.</p>
<p>For example, to schedule 250 mg doses every Monday, Wednesday, and Friday for a month, you can do ::: {.cell}</p>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>data <span class="ot">&lt;-</span> <span class="fu">ev_days</span>(<span class="fu">ev</span>(<span class="at">amt=</span><span class="dv">250</span>, <span class="at">ID=</span><span class="dv">1</span>), <span class="at">days=</span><span class="st">"m,w,f"</span>, <span class="at">addl=</span><span class="dv">3</span>)</span>
<span id="cb32-2"><a href="#cb32-2"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID time amt cmt evid  ii addl
1  1    0 250   1    1 168    3
2  1   48 250   1    1 168    3
3  1   96 250   1    1 168    3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>mod <span class="sc">%&gt;%</span> <span class="fu">mrgsim</span>(<span class="at">data=</span>data,<span class="at">end=</span><span class="dv">168</span><span class="sc">*</span><span class="dv">4</span>) <span class="sc">%&gt;%</span> plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2017-input_data_set_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
<p>:::</p>
<p>Or, you can do 100 mg doses on Monday, Wednesday, Friday, and 50 mg doses on Tuesday, Thursday, with drug holiday on weekends ::: {.cell}</p>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>e1 <span class="ot">&lt;-</span> <span class="fu">ev</span>(<span class="at">amt=</span><span class="dv">100</span>,<span class="at">ID=</span><span class="dv">1</span>)</span>
<span id="cb35-2"><a href="#cb35-2"></a>e2 <span class="ot">&lt;-</span> <span class="fu">ev</span>(<span class="at">amt=</span><span class="dv">50</span>,<span class="at">ID=</span><span class="dv">1</span>)</span>
<span id="cb35-3"><a href="#cb35-3"></a>data <span class="ot">&lt;-</span> <span class="fu">ev_days</span>(<span class="at">m=</span>e1,<span class="at">w=</span>e1,<span class="at">f=</span>e1,<span class="at">t=</span>e2,<span class="at">th=</span>e2,<span class="at">addl=</span><span class="dv">3</span>)</span>
<span id="cb35-4"><a href="#cb35-4"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID time amt cmt evid  ii addl
1  1    0 100   1    1 168    3
2  1   24  50   1    1 168    3
3  1   48 100   1    1 168    3
4  1   72  50   1    1 168    3
5  1   96 100   1    1 168    3</code></pre>
</div>
<p>:::</p>
<p>And simulate ::: {.cell}</p>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>mod <span class="sc">%&gt;%</span> <span class="fu">mrgsim</span>(<span class="at">data=</span>data,<span class="at">end=</span><span class="dv">168</span><span class="sc">*</span><span class="dv">4</span>) <span class="sc">%&gt;%</span> plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2017-input_data_set_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
<p>:::</p>
<p>The same thing can be accomplished like this ::: {.cell}</p>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>a <span class="ot">&lt;-</span> <span class="fu">ev_days</span>(e1,<span class="at">days=</span><span class="st">"m,w,f"</span>,<span class="at">addl=</span><span class="dv">3</span>)</span>
<span id="cb38-2"><a href="#cb38-2"></a>b <span class="ot">&lt;-</span> <span class="fu">ev_days</span>(e2,<span class="at">days=</span><span class="st">"t,th"</span>,<span class="at">addl=</span><span class="dv">3</span>)</span>
<span id="cb38-3"><a href="#cb38-3"></a></span>
<span id="cb38-4"><a href="#cb38-4"></a><span class="fu">c</span>(<span class="fu">as.ev</span>(a),<span class="fu">as.ev</span>(b))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Events:
  ID time amt  ii addl cmt evid
1  1    0 100 168    3   1    1
4  1   24  50 168    3   1    1
2  1   48 100 168    3   1    1
5  1   72  50 168    3   1    1
3  1   96 100 168    3   1    1</code></pre>
</div>
::: You can use this as an event object or just coerce to <code>data.frame</code> to use as a <code>data_set</code>.
<hr>
</section>
</section>
<section id="filter-input-data-set-inline" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Filter input data set inline</h1>
<p>Remember, when you pass in your input data set via <code>data_set</code>, you can filter in line:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>data <span class="ot">&lt;-</span> <span class="fu">expand.ev</span>(<span class="at">amt=</span><span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">200</span>,<span class="dv">300</span>))</span>
<span id="cb40-2"><a href="#cb40-2"></a>mod <span class="sc">%&gt;%</span> <span class="fu">data_set</span>(data, amt<span class="sc">==</span><span class="dv">300</span>) <span class="sc">%&gt;%</span> <span class="fu">Req</span>(GUT,CP) <span class="sc">%&gt;%</span> mrgsim</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model:  housemodel 
Dim:    482 x 4 
Time:   0 to 120 
ID:     1 
    ID time    GUT     CP
1:   3 0.00   0.00  0.000
2:   3 0.00 300.00  0.000
3:   3 0.25 222.25  3.862
4:   3 0.50 164.64  6.676
5:   3 0.75 121.97  8.712
6:   3 1.00  90.36 10.174
7:   3 1.25  66.94 11.211
8:   3 1.50  49.59 11.934</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>